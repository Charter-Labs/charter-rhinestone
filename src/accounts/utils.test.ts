import { describe, expect, test } from 'vitest'
import { encode7579Calls } from './utils'

const target = '0xc7c0190e83dedd6f28cad873b7befe9ab06fc0db'
const data = '0xabcd'

describe('Accounts: Utils', () => {
  describe('Encode ERC-7579 Calls', () => {
    test('single call', () => {
      const calldata = encode7579Calls({
        mode: {
          type: 'call',
          revertOnError: false,
          selector: '0x',
          context: '0x',
        },
        callData: [
          {
            to: target,
            value: 1n,
            data,
          },
        ],
      })

      expect(calldata).toEqual(
        '0xe9ae5c53000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000036c7c0190e83dedd6f28cad873b7befe9ab06fc0db0000000000000000000000000000000000000000000000000000000000000001abcd00000000000000000000',
      )
    })

    test('batch call', () => {
      const calldata = encode7579Calls({
        mode: {
          type: 'batchcall',
          revertOnError: false,
          selector: '0x',
          context: '0x',
        },
        callData: [
          {
            to: target,
            value: 1n,
            data,
          },
          {
            to: target,
          },
        ],
      })

      expect(calldata).toEqual(
        '0xe9ae5c530100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000c7c0190e83dedd6f28cad873b7befe9ab06fc0db000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000002abcd000000000000000000000000000000000000000000000000000000000000000000000000000000000000c7c0190e83dedd6f28cad873b7befe9ab06fc0db000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000',
      )
    })
  })
})
